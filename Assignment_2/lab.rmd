---
title: "Coursework assignment A - 2022-2023"
subtitle: "CS4125 Seminar Research Methodology for Data Science"
author: "Student names"
date: "16/04/2023"
output:
   pdf_document:
      fig_caption: true
      number_sections: true 
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


\tableofcontents

# Part 1 - Design and set-up of true experiment 
```{r load data}
d <- read.csv("Assignment_2/data.csv")
str(d)
table(d$model, d$TeD)
```

## Research question 1
```{r rq one}
linear_model_on_models <- lm(score~model, d)
summary(linear_model_on_models)

# plot the average score for each model
library(ggplot2)
ggplot(d, aes(x=model, y=score)) + geom_boxplot() + geom_jitter(width=0.2)
linear_model_on_trainS_and_models <- lm(score~TeD+model, d)
summary(linear_model_on_trainS_and_models)

AIC(linear_model_on_models, linear_model_on_trainS_and_models)

library(dplyr)
d |> count(model, TeD)

library(emmeans)
as.data.frame(ref_grid(linear_model_on_trainS_and_models))


# Reorder the levels of the model variable
d$model <- factor(d$model, levels = c("B1", "B2", "B3", "M1", "M2", "M3", "MF", "MN", "MS"))

# Training set together with models
linear_model_TrD1 <- lm(score~(TrD1 + TrD2) * model, d)
summary(linear_model_TrD1)

model_names = c("B1", "B2", "M1", "M2", "M3", "MF", "MN", "MS")
for (i in seq_along(model_names)) {
   current_model = model_names[i]
   d_current_model <- d[d$model == current_model, c("TeD", "TrD1", "TrD2", "TrD3", "TrD4", "TrD5", "TrD6", "TrD6", "TrD7", "TrD8", "score")]
   linear_model_current_model <- lm(score~TrD1 + TrD2 + TrD3 + TrD4 + TrD5 + TrD6 + TrD7, d_current_model)
   print(paste0("For: ", current_model))
   print(summary(linear_model_current_model))
}

```
```{r rq one - data transformation}
# By model
ggplot(d, aes(model, score)) +
  geom_boxplot() +
  labs(title = "Boxplot of score by model", x = "Model", y = "Score")
```
```{r rq one - data transformation}
# By TeD
ggplot(d, aes(TeD, score)) +
  geom_boxplot() +
  labs(title = "Boxplot of score by TeD", x = "Test Dataset", y = "Score")

```

```{r rq one - data transformation}
library(reshape2)  # For melting the data
library(pheatmap)  # For creating the heatmap

# Select only TrD columns and melt the data
melted_d <- melt(d[,2:9])

# Create a matrix for the heatmap
heatmap_matrix <- table(melted_d$variable, melted_d$value)

# Generate the heatmap
pheatmap(heatmap_matrix, main = "Heatmap of Training Datasets")

```

```{r rq one - data transformation}
ggplot(d, aes(score)) +
  geom_histogram(bins = 30, fill = "skyblue", color = "black") +
  labs(title = "Histogram of score", x = "Score", y = "Frequency")
```

```{r rq one - data transformation} 
# Q-Q plot
ggplot(d, aes(sample = score)) +
  stat_qq() +
  stat_qq_line() +
  labs(title = "Q-Q plot of score")

# Skewness and kurtosis
library(moments)
paste("Skewness: ", skewness(d$score))
paste("Kurtosis: ", kurtosis(d$score))
```
### Data visualisation
```{r rq one - data transformation}
library(dplyr)
library(moments)

d %>% 
  group_by(model) %>% 
  summarise(skewness = skewness(score))

```

```{r rq one - data transformation}
library(ggplot2)

ggplot(d, aes(x = score)) +
  geom_histogram(bins = 30, fill = "skyblue", color = "black") +
  facet_wrap(~model) +
  labs(title = "Histogram of score by model", x = "Score", y = "Frequency")
```


## Research question 2

### Data visualisation